# API Gateway

## Installation Guide

#### Step 1: Install all composer dependencies

```bash
composer install
```

#### Step 2: Setup environment variable

- Copy `.env.example` to `.env` i.e `cp .env.example .env`
- Update all the variables as needed

## Starting Development Server

Development server can be started in three ways:

* Using ```php artisan serve```
* Using [Valet](https://laravel.com/docs/8.x/valet)
* Docker via [Laravel sail](https://laravel.com/docs/8.x/sail)

I recommend using Laravel sail to start the development server to ensure that the application works perfectly
across all developers' machines regardless of their operating systems.

#### Note:

* If you are using Laravel sail to start your development server, your default database configuration in the .env should
  be as follow:

```bash
  DB_CONNECTION=mysql
  DB_HOST=mysql
  DB_PORT=3306
  DB_DATABASE=your_database_name
  DB_USERNAME=sail
  DB_PASSWORD=password
```

However, if you want to change the DB username and password after springing forth a docker container using the laravel
sail, update the DB_USERNAME and DB_PASSWORD in the .env with the new details and then run this:

```bash
./vendor/bin/sail down -v
./vendor/bin/sail build --no-cache
./vendor/bin/sail up -d
```

To spring up a docker container in detached mode

```bash
./vendor/bin/sail up -d
```

#### Generate a new application key

```bash
./vendor/bin/sail artisan key:generate
``` 

#### Run database migration alongside the seeders

```bash
./vendor/bin/sail artisan migrate:fresh --seed
``` 

#### Generate Oauth secret

- Run `./vendor/bin/sail artisan passport:install` to generate the Oauth token.
Two credentials would be generated, one for `personal access client` and the other for `password grant client`.

- Copy the Client ID and the secret of the latter and update the `.env` accordingly.

#### Generate Post and Comment Service secret
This secret is a random alphanumeric string which can be generated by any random string generator. I used [this website](http://www.unit-conversion.info/texttools/random-string-generator/)
to generate the secrets. However, ensure that the length of the string is `32`

After generating the random strings, ensure you update the `.env` accordingly and also the `.env` for Post and Comment Service.

### Testing

The project testing is done via Pest. You can check [Here](https://pestphp.com/docs/installation) for more
details. <br/>
To run the tests:

```bash
./vendor/bin/sail artisan test
```
