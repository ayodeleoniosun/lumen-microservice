# API Gateway

Note: Docker is used for the development of the app.

#### Step 1: Setup environment variable

- Copy `.env.example` to `.env` i.e `cp .env.example .env`
- Update all the variables as needed

<br/>

#### Step 2: Spring up a docker container in detached mode

```bash
docker-compose up -d --force-recreate
```
<br/> 

#### Step 3: Bash into the database to see if the database has been created
```
docker-compose exec apigateway_db bash
```
<br/> 

#### Step 4: Log into the MySQL "microservices" administrative account
```
mysql -u microservices -p
```
and then input `12345` as the password.

<br/>

#### Step 5: Confirm if the database has been created
Input `SHOW DATABASES;` in the CLI to check if `auth_service_db` has been automatically created when you sprung up the container.

<br/> 

#### Step 6: Exit the MySQL and Bash CLI
Exit the mysql and bash CLI by inputting `exit` on the CLI

<br/> 

#### Step 7: Run database migrations alongside the seeders

```bash
docker-compose exec apigateway php artisan migrate:fresh --seed
```

<br/> 

#### Step 8: Generate Oauth Secret

```bash
docker-compose exec apigateway php artisan passport:install
```  

Two credentials would be generated, one for `personal access client` and the other for `password grant client`.

Copy the Client ID and the secret of the latter and update the `OAUTH_CLIENT_ID` and `OAUTH_CLIENT_SECRET` in the `env` accordingly.

<br/> 

#### Step 9: Generate Post and Comment Service secret
This secret is a random alphanumeric string which can be generated by any random string generator. I used [this website](http://www.unit-conversion.info/texttools/random-string-generator/)
to generate the secrets. However, ensure that the length of the string is `32`

After generating the random strings, ensure you update the `POST_SERVICE_SECRET` and the `COMMENT_SERVICE_SECRET` in the `.env` accordingly and also the `.env` for Post and Comment Service.

<br/> 

#### Step 10: Generate a new application key
Repeat the same process to generate application key and update the `APP_KEY` in the `.env` file with the generated string.

<br/> 

#### Step 11: Testing
Run the following command to run tests:

```bash
docker-compose exec apigateway ./vendor/bin/phpunit
```
